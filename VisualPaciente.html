<!DOCTYPE html>
<html lang="en">

<head>

    <title>UHospital Visual Paciente</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Tooplate">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/tooplate-style.css">
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>


</head>

<body onload="ObtenerDatos()" id="top" data-spy="scroll" data-target=".navbar-collapse" data-offset="50">
    <!-- PRE LOADER -->
    <section class="preloader">
        <div class="spinner">

            <span class="spinner-rotate"></span>

        </div>
    </section>
    <!-- HEADER -->
    <header>
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-5">
                    <p>BIENVENIDO A UHOSPITAL (Salud para todos)</p>
                </div>

                <div class="col-md-8 col-sm-7 text-align-right">
                    <span class="phone-icon"><i class="fa fa-phone"></i>+502 57707472</span>
                    <span class="date-icon"><i class="fa fa-calendar-plus-o"></i> 6:00 AM - 10:00 PM
                        (Lunes-Viernes)</span>
                    <span class="email-icon"><i class="fa fa-envelope-o"></i> <a
                            href="#">3034161730108@ingenieria.usac.edu.gt</a></span>
                </div>

            </div>
        </div>
    </header>


    <!-- DATA TABLE-->
    <section class="p-t-20">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="title-5 m-b-35">Visualización de Pacientes</h3>
                    <div class="table-data__tool">
                        <div class="table-data__tool-left">
                            <div class="rs-select2--light rs-select2--md">

                                <div class="dropDownSelect2"></div>
                            </div>
                            <div class="rs-select2--light rs-select2--sm">

                                <div class="dropDownSelect2"></div>
                            </div>

                        </div>
                        <div class="table-data__tool-right">

                            <div class="rs-select2--dark rs-select2--sm rs-select2--dark2">
                                <button onclick="Regresar()" type="button"
                                    class="btn btn-primary btn-lg active">Regresar</button>
                                <div class="dropDownSelect2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive table-responsive-data2">
                        <table id="datatable" class="table table-data2">
                            <thead>
                                <tr>
                                    <th>
                                        <label class="au-checkbox">
                                            <input type="checkbox">
                                            <span class="au-checkmark"></span>
                                        </label>
                                    </th>
                                    <th>Nombre</th>
                                    <th>Apellido</th>
                                    <th>Fecha de Nacimiento</th>
                                    <th>Sexo</th>
                                    <th>Nombre de Usuario</th>
                                    <th>Contraseña</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="detalles"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- END DATA TABLE-->

    <button onclick="PDF()" class="au-btn au-btn--block au-btn--green m-b-20" type="button">GENERAR REPORTE EN
        PDF</button>


    <!-- TODO:GOOGLE MAP 
    <section id="google-map">
        <iframe
            src="https://maps.google.com/maps?width=100%25&amp;height=1490&amp;hl=en&amp;q=San%20Carlos%20University+(Universidad%20de%20San%20Carlos%20de%20Guatemala)&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed"
            width="100%" height="350" frameborder="0" style="border:0" allowfullscreen></iframe>
    </section>
-->

    <!-- FOOTER -->
    <footer data-stellar-background-ratio="5">
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-4">
                    <div class="footer-thumb">
                        <h4 class="wow fadeInUp" data-wow-delay="0.4s">Contáctenos</h4>
                        <p>202000194</p>

                        <div class="contact-info">
                            <p><i class="fa fa-phone"></i> +502 57707472</p>
                            <p><i class="fa fa-envelope-o"></i> <a href="#">3034161730108@ingenieria.usac.edu.gt</a></p>
                        </div>
                    </div>
                </div>
                <!--
                    <div class="col-md-4 col-sm-4"> 
                         <div class="footer-thumb"> 
                              <h4 class="wow fadeInUp" data-wow-delay="0.4s">Ultimas Actualizaciones</h4>
                              <div class="latest-stories">
                                   <div class="stories-image">
                                        <a href="#"><img src="images/news-image.jpg" class="img-responsive" alt=""></a>
                                   </div>
                                   <div class="stories-info">
                                        <a href="#"><h5>Amazing Technology</h5></a>
                                        <span>March 08, 2018</span>
                                   </div>
                              </div>

                              <div class="latest-stories">
                                   <div class="stories-image">
                                        <a href="#"><img src="images/news-image.jpg" class="img-responsive" alt=""></a>
                                   </div>
                                   <div class="stories-info">
                                        <a href="#"><h5>New Healing Process</h5></a>
                                        <span>February 20, 2018</span>
                                   </div>
                              </div>
                         </div>
                    </div>
                    -->
                <div class="col-md-4 col-sm-4">
                    <div class="footer-thumb">
                        <div class="opening-hours">
                            <h4 class="wow fadeInUp" data-wow-delay="0.4s">Horario de Atención</h4>
                            <p>Lunes - Viernes <span>06:00 AM - 10:00 PM</span></p>
                            <p>Sabado <span>09:00 AM - 08:00 PM</span></p>
                            <p>Domingo <span>Cerrado, es dia de Dios</span></p>
                        </div>

                        <ul class="social-icon">
                            <li><a href="#" class="fa fa-facebook-square" attr="facebook icon"></a></li>
                            <li><a href="#" class="fa fa-twitter"></a></li>
                            <li><a href="#" class="fa fa-instagram"></a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-12 col-sm-12 border-top">
                    <div class="col-md-4 col-sm-6">
                        <div class="copyright-text">
                            <p>Copyright &copy; 2022 UHospital

                                | Diseño: El Bootstrap :v</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6">
                        <div class="footer-link">
                            <a href="https://www.who.int/es">OMS</a>
                            <a href="https://www.mspas.gob.gt">MSPAS</a>
                            <a href="https://www.gob.pe/minsa/">MINSA</a>
                            <a href="https://covid19.who.int">COVID 19 INFO</a>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 text-align-center">
                        <div class="angle-up-btn">
                            <a href="#top" class="smoothScroll wow fadeInUp" data-wow-delay="1.2s"><i
                                    class="fa fa-angle-up"></i></a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/smoothscroll.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <script>
        function Regresar() {
            location.href = "Panel_Admin.html"
        }
    </script>
    <!--SCRIPT PARA OBTENER DATOS ELIMINAR.,.. ETC CRUD-->
    <script>

        function ObtenerDatos() {
            // La estructura del fetch no cambia, solo cambian los atributos, como el tipo de metodo.
            var tabla = document.querySelector('#detalles')
            var idpacientes = 0
            // Esta cadena nos servira para escribir los datos en la tabla.
            var cadena = ''

            fetch('https://backend-202000194.herokuapp.com/Pacientes', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                }
            })
                .then(res => res.json())
                .catch(err => {
                    console.error('Error:', err)
                    alert("Ocurrio un error, ver la consola")
                })
                .then(response => {
                    console.log(response);
                    response.forEach(element => {
                        console.log(element)
                        cadena += `
                        
                        <tr class="tr-shadow">
                                    <td>
                                        <label class="au-checkbox">
                                            <input type="checkbox">
                                            <span class="au-checkmark"></span>
                                        </label>
                                    </td>
                                    <td>${element.Nombre}</td>
                                    <td>
                                        ${element.Apellido}
                                    </td>
                                    <td>${element.Fecha}</td>
                                    <td class="desc">${element.Sexo}</td>
                                    <td>
                                        <span class="status--process">${element.Username}</span>
                                    </td>
                                    <td><span   class="block-email">${element.Contra}</span></td>

                                    <td>
                                        <div class="table-data-feature" >
                                            <button value=${element.Nombre} onclick="VerPerfil(this)" type="item" class="item"  data-placement="top" title="visualizar" >
                                                <i   class="zmdi zmdi-eye"></i>
                                            </button>
                                            <button value=${element.Nombre} onclick="ModificarPerfil(this)" class="item" data-toggle="tooltip" data-placement="top"
                                                title="Editar"  >
                                                <i class="zmdi zmdi-edit"></i>
                                            </button>
                                            <button value=${element.Nombre} onclick="Eliminar(this)" class="item" data-toggle="tooltip" data-placement="top"
                                                title="Eliminar"> 
                                                <i class="zmdi zmdi-delete"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="spacer"></tr>

                        
                        
                        `
                        idpacientes++;
                        // Cabe destacar que tambien se pueden agregar otras etiquetas, en si se trabaja como texto.
                        // NOTA: Recuerden no user '' si no que `` para que los deje usar el ${} y agregar variables al texto.
                    });

                    // POR ULTIMO: Usamos innerHTML para agregar el HTML a la etiqueta que indicamos anteriormente.
                    tabla.innerHTML = cadena
                })
        }
        //LE MANDO LOS DATOS A VERPERFIL PARA QUE MUESTRE LOS DATOS VERPERFIL
        function VerPerfil(item) {
            console.log(item)
            var usuario = item.value
            console.log(usuario)

            sessionStorage.setItem("buscar", usuario)
            location.href = "VerPerfil.html"
        }
        //SE MODIFICA EL PERFIL DEL PACIENTE SELECCIONADO
        function ModificarPerfil(item) {
            console.log(item)
            var usuario = item.value
            console.log(usuario)
            sessionStorage.setItem("buscar", usuario)
            location.href = "ModificarPerfil.html"
        }
        //SE ELIMINA EL DATO SELECCIONADO DE LA TABLA
        // METODO ELIMINAR
        function Eliminar(item) {
            var nombre = item.value
            console.log(nombre)
            fetch(`https://backend-202000194.herokuapp.com/Pacientes/${nombre}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                }
            })
                .then(res => res.json())
                .catch(err => {
                    console.error('Error:', err)
                    alert("Ocurrio un error, ver la consola")
                })
                .then(response => {
                    console.log(response);
                    alert(response.Mensaje)
                    actualizar()
                })
            
        }

    </script>

    <script type="text/javascript">
        function actualizar() { location.reload(true); }
        function PDF() {
            var pdf = new jsPDF();
            //pdf.text(20, 20, " REPORTE GENERAL DE PACIENTES");
            //pdf.text(20, 40, "Vista de Pacientes: ");
            var columns = ["No.", "NOMBRE", "PRECIO", "CANTIDAD", "SUBTOTAL"];
            //pdf.text(20, 20, "DATOS DE PACIENTES: ");
            var bodytab = document.getElementById("datatable");
            var tabjson = pdf.autoTableHtmlToJson(bodytab);
            var headerTxt = "                       REPORTE GENERAL DE PACIENTES"
            var header = function (data) {
                pdf.setFontSize(18);
                pdf.setTextColor(10);
                pdf.setFontStyle('normal');
                //doc.addImage(headerImgData, 'JPEG', data.settings.margin.left, 20, 50, 50);
                pdf.text(headerTxt, data.settings.margin.left, 10);
            };
            var options = {
                beforePageContent: header,
                margin: {top: 15},
                startY: pdf.autoTableEndPosY() + 15
            };
            pdf.autoTable(tabjson.columns, tabjson.data, options);
            pdf.save('REPORTE_pacientes.pdf');
        }
    </script>






</body>

</html>