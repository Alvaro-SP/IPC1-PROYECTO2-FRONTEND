<!DOCTYPE html>
<html lang="en">

<head>

    <title>UHospital Pedido</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Tooplate">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/tooplate-style.css">
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

</head>

<body onload="ObtenerDatos()" id="top" data-spy="scroll" data-target=".navbar-collapse" data-offset="50">
    <!-- PRE LOADER -->
    <section class="preloader">
        <div class="spinner">

            <span class="spinner-rotate"></span>

        </div>
    </section>
    <!-- HEADER -->
    <header>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-5">
                    <p>BIENVENIDO A UHOSPITAL (Salud para todos)</p>
                </div>

                <div class="col-md-8 col-sm-7 text-align-right">
                    <span class="phone-icon"><i class="fa fa-phone"></i>+502 57707472</span>
                    <span class="date-icon"><i class="fa fa-calendar-plus-o"></i> 6:00 AM - 10:00 PM
                        (Lunes-Viernes)</span>
                    <span class="email-icon"><i class="fa fa-envelope-o"></i> <a
                            href="#">3034161730108@ingenieria.usac.edu.gt</a></span>
                </div>

            </div>
        </div>
    </header>


    <!-- DATA TABLE-->
    <section class="p-t-20">
        <div class="container">
            <div class="row" id="content">
                <div class="col-md-12">
                    <h3 class="title-5 m-b-35">PEDIDO</h3>
                    <div class="table-data__tool">
                        <div class="table-data__tool-left">
                            <div class="rs-select2--light rs-select2--md">

                                <div class="dropDownSelect2"></div>
                            </div>
                            <div class="rs-select2--light rs-select2--sm">

                                <div class="dropDownSelect2"></div>
                            </div>

                        </div>
                        <div class="table-data__tool-right">

                            <div class="rs-select2--dark rs-select2--sm rs-select2--dark2">
                                <button onclick="Regresar()" type="button"
                                    class="btn btn-primary btn-lg active">Regresar</button>
                                <div class="dropDownSelect2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive table-responsive-data2">
                        <table id="tablapedido" class="table table-data2">
                            <thead>
                                <tr>


                                    <!--
                                        <label class="au-checkbox">
                                            <input type="checkbox">
                                            <span class="au-checkmark"></span>
                                        </label>
                                        -->


                                    <th>                       NOMBRE</th>
                                    <th>                       PRECIO</th>
                                    <th>                       CANTIDAD</th>
                                    <th>                       SUBTOTAL</th>
                                    <th>                       QUITAR / AGREGAR / VER / ELIMINAR</th>



                                </tr>
                            </thead>
                            <div>
                                <tbody id="detalles"></tbody>
                            </div>

                        </table>
                    </div>

                </div>


            </div>
            <div id="elementH"></div>
            <!--▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬DESCARGAR PDF DEL PEDIDO▬▬▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬▄▄▄▄▄▄▬▬-->
            <button onclick="PDFpedido()" class="au-btn au-btn--small au-btn--green m-1" type="button">REGISTRAR
                PEDIDO</button>
            <script>
                var data = [];
                var n = 0
                function PDFpedidoO() {

                    var pdf = new jsPDF();
                    var Subtotal = 0
                    var total = 0
                    pdf.text(20, 20, "Pedido de Medicinas: ");

                    var columns = ["No.", "NOMBRE", "PRECIO", "CANTIDAD", "SUBTOTAL"];



                    doc.autoTable({
                        columns, data,
                    })
                    const doc = new jsPDF()
                    autoTable(doc, { html: '#my-table' })
                    pdf.save('mipdf.pdf');


                }



                function PDFpedido() {
                    var pdf = new jsPDF();
                    //pdf.text(20, 20, " REPORTE GENERAL DE PACIENTES");
                    //pdf.text(20, 40, "Vista de Pacientes: ");
                    //var columns = ["No.", "NOMBRE", "PRECIO", "CANTIDAD", "SUBTOTAL"];
                    //pdf.text(20, 20, "DATOS DE PACIENTES: ");
                    var bodytab = document.getElementById("tablapedido");
                    var tabjson = pdf.autoTableHtmlToJson(bodytab);
                    var headerTxt = "                       REPORTE GENERAL DE PACIENTES"
                    var header = function (data) {
                        pdf.setFontSize(18);
                        pdf.setTextColor(10);
                        pdf.setFontStyle('normal');
                        //doc.addImage(headerImgData, 'JPEG', data.settings.margin.left, 20, 50, 50);
                        pdf.text(headerTxt, data.settings.margin.left, 10);
                    };
                    var options = {
                        beforePageContent: header,
                        margin: { top: 15 },
                        startY: pdf.autoTableEndPosY() + 15
                    };
                    pdf.autoTable(tabjson.columns, tabjson.data, options);
                    pdf.save('REPORTE_enfermeras.pdf');

                }

                //NO SE USA
                function gendata() {

                    fetch('https://backend-202000194.herokuapp.com/Medicinas', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                        }
                    })

                        .then(res => res.json())
                        .catch(err => {
                            console.error('Error:', err)
                            alert("Ocurrio un error, ver la consola")
                        })
                        .then(response => {
                            console.log(response);
                            response.forEach(element => {
                                console.log(element)
                                console.log("hola xdxdxd")
                                Subtotal = parseInt(element.Cantidad) * parseInt(element.Precio)
                                total = total + Subtotal
                                var temp = [n, element.Nombre, element.Precio, element.Cantidad, Subtotal]
                                n++
                                data.push(temp);

                            });


                        })

                }


                //<!--Nose usa-->
                function PDFpedido2() {
                    var pdf = new jsPDF('p', 'pt', 'letter');
                    pdf.setFontSize(24);
                    // source can be HTML-formatted string, or a reference
                    // to an actual DOM element from which the text will be scraped.
                    source = $('#content')[0];

                    // we support special element handlers. Register them with jQuery-style 
                    // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
                    // There is no support for any other type of selectors 
                    // (class, of compound) at this time.
                    specialElementHandlers = {
                        // element with id of "bypass" - jQuery style selector
                        '#bypassme': function (element, renderer) {
                            // true = "handled elsewhere, bypass text extraction"
                            return true
                        }
                    };
                    margins = {
                        top: 80,
                        bottom: 60,
                        left: 40,
                        width: 522
                    };
                    // all coords and widths are in jsPDF instance's declared units
                    // 'inches' in this case
                    pdf.fromHTML(
                        source, // HTML string or DOM elem ref.
                        margins.left, // x coord
                        margins.top, { // y coord
                        'width': margins.width, // max width of content on PDF
                        'elementHandlers': specialElementHandlers
                    },

                        function (dispose) {
                            // dispose: object with X, Y of the last line add to the PDF 
                            //          this allow the insertion of new lines after html
                            pdf.save('Test.pdf');
                        }, margins
                    );
                }
            </script>




            <!--GENERA EL PDF PERO CON CANVAS-->
            <script type="text/javascript" src="/dist//html2canvas.js"></script>

            <script type="text/javascript">


            </script>



        </div>
    </section>
    <!-- END DATA TABLE-->


    <!-- TODO:GOOGLE MAP 
    <section id="google-map">
        <iframe
            src="https://maps.google.com/maps?width=100%25&amp;height=1490&amp;hl=en&amp;q=San%20Carlos%20University+(Universidad%20de%20San%20Carlos%20de%20Guatemala)&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed"
            width="100%" height="350" frameborder="0" style="border:0" allowfullscreen></iframe>
    </section>
-->

    <!-- FOOTER -->
    <footer data-stellar-background-ratio="5">
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-4">
                    <div class="footer-thumb">
                        <h4 class="wow fadeInUp" data-wow-delay="0.4s">Contáctenos</h4>
                        <p>202000194</p>

                        <div class="contact-info">
                            <p><i class="fa fa-phone"></i> +502 57707472</p>
                            <p><i class="fa fa-envelope-o"></i> <a href="#">3034161730108@ingenieria.usac.edu.gt</a></p>
                        </div>
                    </div>
                </div>
                <!--
                    <div class="col-md-4 col-sm-4"> 
                         <div class="footer-thumb"> 
                              <h4 class="wow fadeInUp" data-wow-delay="0.4s">Ultimas Actualizaciones</h4>
                              <div class="latest-stories">
                                   <div class="stories-image">
                                        <a href="#"><img src="images/news-image.jpg" class="img-responsive" alt=""></a>
                                   </div>
                                   <div class="stories-info">
                                        <a href="#"><h5>Amazing Technology</h5></a>
                                        <span>March 08, 2018</span>
                                   </div>
                              </div>

                              <div class="latest-stories">
                                   <div class="stories-image">
                                        <a href="#"><img src="images/news-image.jpg" class="img-responsive" alt=""></a>
                                   </div>
                                   <div class="stories-info">
                                        <a href="#"><h5>New Healing Process</h5></a>
                                        <span>February 20, 2018</span>
                                   </div>
                              </div>
                         </div>
                    </div>
                    -->
                <div class="col-md-4 col-sm-4">
                    <div class="footer-thumb">
                        <div class="opening-hours">
                            <h4 class="wow fadeInUp" data-wow-delay="0.4s">Horario de Atención</h4>
                            <p>Lunes - Viernes <span>06:00 AM - 10:00 PM</span></p>
                            <p>Sabado <span>09:00 AM - 08:00 PM</span></p>
                            <p>Domingo <span>Cerrado, es dia de Dios</span></p>
                        </div>

                        <ul class="social-icon">
                            <li><a href="#" class="fa fa-facebook-square" attr="facebook icon"></a></li>
                            <li><a href="#" class="fa fa-twitter"></a></li>
                            <li><a href="#" class="fa fa-instagram"></a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-12 col-sm-12 border-top">
                    <div class="col-md-4 col-sm-6">
                        <div class="copyright-text">
                            <p>Copyright &copy; 2022 UHospital

                                | Diseño: El Bootstrap :v</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6">
                        <div class="footer-link">
                            <a href="https://www.who.int/es">OMS</a>
                            <a href="https://www.mspas.gob.gt">MSPAS</a>
                            <a href="https://www.gob.pe/minsa/">MINSA</a>
                            <a href="https://covid19.who.int">COVID 19 INFO</a>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 text-align-center">
                        <div class="angle-up-btn">
                            <a href="#top" class="smoothScroll wow fadeInUp" data-wow-delay="1.2s"><i
                                    class="fa fa-angle-up"></i></a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/smoothscroll.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <!-- jQuery library -->
    <script src="js/jquery.min.js"></script>

    <!-- jsPDF library -->
    <script src="js/jsPDF/dist/jspdf.min.js"></script>

    <script>
        function Regresar() {
            location.href = "Panel_Paciente.html"
        }
    </script>
    <!--SCRIPT PARA OBTENER DATOS ELIMINAR.,.. ETC CRUD-->
    <script>
        var listado = [];
        var Subtotal = 0
        var total = 0
        var cantidad = 0
        var idpacientes = 0
        //MANDAR EL ARRAY CON LAS MEDICINAS SELECCIONADAS
        function ObtenerDatos() {
            // La estructura del fetch no cambia, solo cambian los atributos, como el tipo de metodo.
            var tabla = document.querySelector('#detalles')


            // Esta cadena nos servira para escribir los datos en la tabla.
            var cadena = ''

            fetch('https://backend-202000194.herokuapp.com/Medicinas/Pedido', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                }
            })
                .then(res => res.json())
                .catch(err => {
                    console.error('Error:', err)
                    alert("Ocurrio un error, ver la consola")
                })
                .then(response => {
                    console.log(response);
                    response.forEach(element => {
                        console.log(element)

                        Subtotal = parseInt(element.Cantidad) * parseInt(element.Precio)
                        precio = element.Precio
                        total = total + Subtotal
                        cantidad = element.Cantidad
                        nombre = element.Nombre
                        temp = [idpacientes, element.Nombre, element.Precio, element.Cantidad, Subtotal]
                        cadena += `
                        
                        <tr id=${nombre} class="tr-shadow">
                           
                                        <!--
                                        <label class="au-checkbox">
                                            <input type="checkbox">
                                            <span class="au-checkmark"></span>
                                        </label>
                                    -->
                                    
                                    <td>                  ${element.Nombre}</td>
                                    <td>
                                                          ${element.Precio}
                                    </td>
                                    <td>                  ${element.Cantidad}</td>
                                    <td class="desc">                       Q. ${Subtotal}</td>
                                    
               
                                    <td>
                                        
                                        <div class="table-data-feature" >
                                            <button value=${element.Nombre} onclick="menos(this, ${precio} , ${cantidad}, ${Subtotal})" type="item" class="item"  data-placement="top" title="MENOS" >
                                                <i   class="zmdi zmdi-minus-circle"></i>
                                            </button>
                                            <button value=${element.Nombre} onclick="mas(this)" class="item" data-toggle="tooltip" data-placement="top"
                                                title="MAS"  >
                                                <i class="zmdi zmdi-plus-circle"></i>
                                            </button>
                                            <button value=${element.Nombre} onclick="VerMedicina(this)" type="item" class="item"  data-placement="top" title="visualizar" >
                                                <i   class="zmdi zmdi-eye"></i>
                                            </button>
                                            
                                            <button value=${element.Nombre} onclick="Eliminar(this)" class="item" data-toggle="tooltip" data-placement="top"
                                                title="Eliminar"> 
                                                <i class="zmdi zmdi-delete"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <!--<tr class="spacer">  </tr>-->
                                                        
                        
                        `

                        idpacientes++;
                    });
                    cadena += `
                <tr> <th></th>
                                    
                                     
                                    <th></th>
                                    <div >
                                    <th><h2>                            TOTAL: </h2></th>
                                    <th><h2><span id="tots" class="status--process">                           Q. ${total} </span></h2></th>
                                    </div>
                                    <th></th> </tr>`
                    console.log(cadena)
                    tabla.innerHTML = cadena
                })


        }

        //LE MANDO LOS DATOS A VERPERFIL PARA QUE MUESTRE LOS DATOS VERPERFIL
        function VerMedicina(item) {
            console.log(item)
            var usuario = item.value
            console.log(usuario)

            sessionStorage.setItem("buscar", usuario)
            location.href = "VerMedicina2.html"
        }
        //SE MODIFICA EL PERFIL DEL PACIENTE SELECCIONADO
        function ModificarPerfil(item) {
            console.log(item)
            var usuario = item.value
            console.log(usuario)
            sessionStorage.setItem("buscar", usuario)
            location.href = "ModificarPerfil.html"
        }
        //SE ELIMINA EL DATO SELECCIONADO DE LA TABLA
        // METODO ELIMINAR
        function Eliminar(item) {
            var nombre = item.value
            console.log(nombre)
            fetch(`https://backend-202000194.herokuapp.com/Medicinas/Pedido/${nombre}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                }
            })
                .then(res => res.json())
                .catch(err => {
                    console.error('Error:', err)
                    alert("Ocurrio un error, ver la consola")
                })
                .then(response => {
                    console.log(response);
                    alert(response.Mensaje)
                    location.href = "pedido.html"
                })
            //
        }

        actualizar()
    </script>

    <script type="text/javascript">
        function actualizar() { location.reload(true); }

        function menos(nam, price, cant, sub) {
             
            nam=nam.value
            console.log(nam)
            var changevalue = document.querySelector(`#${nam}`)
            var tots = document.querySelector("#tots")
            var cadena = ""
            var cadenatots = ""
            console.log(nam)
            console.log(price)
            console.log(cant)
            console.log(sub)
            total = total - sub
            cant -= 1
            if (cant != 0) {
                //var nombre = item.value
                // filaselect = document.getElementById(nombre)
                sub = cant * price
                total = total + sub
                console.log("cantidad")
                console.log(cant)
                console.log("Nuevo subtotal")
                console.log(sub)
                console.log("nuevo total")
                console.log(total)
                cadena=`
               
                           
                           <!--
                           <label class="au-checkbox">
                               <input type="checkbox">
                               <span class="au-checkmark"></span>
                           </label>
                       -->
                       
                       <td>                  ${nam}</td>
                       <td>
                                             ${price}
                       </td>
                       <td>                  ${cant}</td>
                       <td class="desc">                       Q. ${sub}</td>
                       
  
                       <td>
                           
                           <div class="table-data-feature" >
                               <button value=${nam} onclick="menos(this, ${price} , ${cant}, ${sub})" type="item" class="item"  data-placement="top" title="MENOS" >
                                   <i   class="zmdi zmdi-minus-circle"></i>
                               </button>
                               <button value=${nam} onclick="mas(this)" class="item" data-toggle="tooltip" data-placement="top"
                                   title="MAS"  >
                                   <i class="zmdi zmdi-plus-circle"></i>
                               </button>
                               <button value=${nam} onclick="VerMedicina(this)" type="item" class="item"  data-placement="top" title="visualizar" >
                                   <i   class="zmdi zmdi-eye"></i>
                               </button>
                               
                               <button value=${nam} onclick="Eliminar(this)" class="item" data-toggle="tooltip" data-placement="top"
                                   title="Eliminar"> 
                                   <i class="zmdi zmdi-delete"></i>
                               </button>
                           </div>
                       </td>
                  
                   <!--<tr class="spacer">  </tr>-->
                
                
                
                
                `
                cadenatots+=`                            Q. ${total}  
                
                `
               
                console.log(cadena)
                console.log(cadenatots)

                changevalue.innerHTML = cadena
                tots.innerHTML = cadenatots
                


            }




        }
 
        function mas(nam, price, cant, sub) {
             
             nam=nam.value
             console.log(nam)
             var changevalue = document.querySelector(`#${nam}`)
             var tots = document.querySelector("#tots")
             var cadena = ""
             var cadenatots = ""
             console.log(nam)
             console.log(price)
             console.log(cant)
             console.log(sub)
             total = total - sub
             cant += 1
             if (cant != 0) {
                 //var nombre = item.value
                 // filaselect = document.getElementById(nombre)
                 sub = cant * price
                 total = total + sub
                 console.log("cantidad")
                 console.log(cant)
                 console.log("Nuevo subtotal")
                 console.log(sub)
                 console.log("nuevo total")
                 console.log(total)
                 cadena=`
                
                            
                            <!--
                            <label class="au-checkbox">
                                <input type="checkbox">
                                <span class="au-checkmark"></span>
                            </label>
                        -->
                        
                        <td>                  ${nam}</td>
                        <td>
                                              ${price}
                        </td>
                        <td>                  ${cant}</td>
                        <td class="desc">                       Q. ${sub}</td>
                        
   
                        <td>
                            
                            <div class="table-data-feature" >
                                <button value=${nam} onclick="menos(this, ${price} , ${cant}, ${sub})" type="item" class="item"  data-placement="top" title="MENOS" >
                                    <i   class="zmdi zmdi-minus-circle"></i>
                                </button>
                                <button value=${nam} onclick="mas(this)" class="item" data-toggle="tooltip" data-placement="top"
                                    title="MAS"  >
                                    <i class="zmdi zmdi-plus-circle"></i>
                                </button>
                                <button value=${nam} onclick="VerMedicina(this)" type="item" class="item"  data-placement="top" title="visualizar" >
                                    <i   class="zmdi zmdi-eye"></i>
                                </button>
                                
                                <button value=${nam} onclick="Eliminar(this)" class="item" data-toggle="tooltip" data-placement="top"
                                    title="Eliminar"> 
                                    <i class="zmdi zmdi-delete"></i>
                                </button>
                            </div>
                        </td>
                   
                    <!--<tr class="spacer">  </tr>-->
                 
                 
                 
                 
                 `
                 cadenatots+=`                            Q. ${total}  
                 
                 `
                
                 console.log(cadena)
                 console.log(cadenatots)
 
                 changevalue.innerHTML = cadena
                 tots.innerHTML = cadenatots
                 
 
 
             }
 
 
 
 
         }
  
 








    </script>






</body>

</html>